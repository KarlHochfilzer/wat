<% if params[:search].present? %>
  $('#result').html('<%= escape_javascript( 
      unless @users.any?
        content_tag :div, :class => "alert alert-error" do
          t(:no_user_found_for, search: @search.search_text)
        end
      else
        content_tag :div, :class => "each_user_show" do
          @users.each do |user|
            render "user", :user => user
          end
          render :partial => "/shared/load_more", :locals => { :resources => @users, :path => users_path }
        end
        page_navigation_links( @users, "pagination", "&#8592; Previous", "Next &#8594;" )
      end
  ) -%>');
<% end %>

/* REVIEW: This file is needed for any endles-loading view. Is there a way to unify this, so we have it only once? */
$(".pagination").html("<%= escape_javascript( page_navigation_links( @users, 'pagination', '&#8592; Previous', 'Next &#8594;' ) ) %>");

$('.load_more').before( '<div id="page<%= @users.current_page -%>" style="clear: both; display: none;">'+
                          '<p class="page_seperator"><%= @users.current_page -%>'+
                          '/<%= @users.total_pages -%></p>'+
                          '<%= escape_javascript(render(:partial => @users)) -%>'+
                          '</div>');

<% if is_on_last_page(@users) %>
  $('#load_more').html( '<%=  escape_javascript(link_to_function(t(:load_more),"insert_load_button( 'load_more','#{t(:loading)}',"+
        "'#{users_path(:page => (params[:page] ? (params[:page].to_i+1) : 2),:order => params[:order].to_sym, :direction => params[:direction].to_sym)}')", :id => "load_more_link" )) -%>');
  $('#page<%= @users.current_page -%>').slideDown();
  setTimeout("checkScroll()", 500);
<% else %>
  $('#page<%= @users.current_page -%>').slideDown();
  $('#load_more').html('<p style="text-align:center; margin-top: 20px;"><%= escape_javascript(t(:end_of_list)) -%></p>');
  $(".pagination").hide();
<% end %>
